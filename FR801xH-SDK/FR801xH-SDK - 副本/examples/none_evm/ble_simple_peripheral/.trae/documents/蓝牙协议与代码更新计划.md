# 蓝牙协议与代码更新计划

## 1. 更新通用蓝牙协议文档

### 1.1 完善命令号总表
- 在 `doc/通用蓝牙协议.md` 文件中，为每个命令添加数据段说明
- 数据段说明应包括：
  - 请求数据格式（SOC → MCU）
  - 应答数据格式（MCU → SOC）
  - 字段含义与长度
  - 示例数据

### 1.2 格式规范
- 保持文档结构清晰，使用表格形式展示
- 确保数据段说明与代码实现一致
- 添加必要的注释和说明

## 2. 修改 ble_function.c 中的串口发送逻辑

### 2.1 完善串口发送函数
- 检查 `SocMcu_Frame_Send` 函数的实现
- 确保发送数据格式符合协议规范
- 添加必要的错误处理和日志

### 2.2 优化命令映射
- 检查 `BleFunc_MapBleCmdToMcuId` 函数
- 确保所有命令都能正确映射到对应的MCU命令号
- 添加缺失的命令映射

### 2.3 增强数据处理
- 优化数据解析和封装逻辑
- 确保数据段的格式和长度正确
- 添加数据验证和错误处理

## 3. 更新 PyQt 上位机（串口助手）

### 3.1 更新协议解析
- 修改 `code/serial_assistant/protocol/` 目录下的协议解析文件
- 确保支持最新的命令格式和数据段
- 添加命令解析和验证功能

### 3.2 优化 UI 界面
- 更新 `code/serial_assistant/ui/` 目录下的界面文件
- 添加命令编辑和发送功能
- 增强数据接收和显示功能

### 3.3 添加配置文件
- 更新 `code/serial_assistant/data/commands.json` 文件
- 添加所有命令的配置信息
- 确保与协议文档一致

## 4. 测试与验证

### 4.1 协议验证
- 确保协议文档与代码实现一致
- 验证命令格式和数据段说明的正确性

### 4.2 功能测试
- 测试串口发送和接收功能
- 验证命令映射和数据处理的正确性
- 测试上位机的功能和界面

### 4.3 兼容性测试
- 确保与现有代码的兼容性
- 验证与MCU的通信正常

## 5. 文档更新

### 5.1 更新开发文档
- 确保所有代码和文档都有清晰的注释
- 更新开发日志和说明文档

### 5.2 提交更新
- 整理所有修改的文件
- 确保代码和文档的一致性
- 准备提交更新