# 串口测试助手实现计划

## 概述

创建一个独立的基于Python的串口测试助手，使用PyQt构建用户界面，专门用于测试代码库中实现的SOC→MCU和MCU→SOC通信协议。**完全独立实现，不修改任何现有代码**。

## 技术要求

* **环境**：使用conda的rknn环境
* **语言**：Python 3.x
* **库**：PyQt5, pyserial
* **功能**：支持BLE协议和UART协议测试，包含所有命令解析和模拟回复

## 实现步骤

### 1. 项目搭建

* **创建独立文件夹**：在桌面或其他位置创建专门的串口测试助手文件夹
* **环境配置**：在conda环境中安装所需包
  - `pip install pyqt5 pyserial`
* **项目结构**：
  - `serial_assistant/`
    - `main.py` (主程序入口)
    - `protocol/` (协议实现)
      - `uart_protocol.py` (UART协议处理)
      - `ble_protocol.py` (BLE协议处理)
      - `command_parser.py` (命令解析器)
    - `ui/` (界面相关)
      - `main_window.py` (主窗口实现)
      - `command_editor.py` (命令编辑器)
    - `data/`
      - `commands.json` (命令定义和描述)

### 2. 协议实现

* **UART协议处理器**：
  - 完全基于usart_device.c和usart_cmd.h的协议规范
  - 实现SOC_MCU_Frame_Build功能的Python版本
  - 实现CRC16-CCITT校验
  - 支持所有命令ID定义
  - 实现帧解析和构建

* **BLE协议处理器**：
  - 完全基于protocol.c和protocol.h的协议规范
  - 实现带加密支持的帧构造
  - 实现带BCC校验的帧解析
  - 支持AES128加密/解密
  - 支持PKCS7填充

* **命令解析器**：
  - 从usart_cmd.h提取所有命令ID和描述
  - 构建命令数据库
  - 支持命令参数解析
  - 支持命令分类显示

### 3. 命令数据库构建

* **从代码提取命令**：
  - 解析usart_cmd.h中的所有命令定义
  - 为每个命令创建详细描述
  - 分类组织命令（如NFC相关、油车相关等）

* **命令分类**：
  - 蓝牙相关命令
  - NFC相关命令
  - 油车控制命令
  - 智能设置命令
  - 车辆模式命令
  - 传感器相关命令

### 4. 模拟回复系统

* **自动回复功能**：
  - 基于收到的命令自动生成合适的回复
  - 支持SOC→MCU和MCU→SOC方向
  - 模拟不同的响应状态

* **回复模板**：
  - 为常用命令创建标准回复模板
  - 支持自定义回复内容
  - 模拟错误情况回复

### 5. UI设计（PyQt5）

* **主窗口**：
  - 串口配置（COM端口、波特率）
  - 协议选择（UART或BLE）
  - 命令分类导航
  - 命令选择下拉菜单（包含所有可用命令）
  - 命令参数编辑器
  - 数据输入区域（用于负载数据）
  - 发送按钮
  - 响应显示区域（带十六进制/ASCII切换）
  - 调试日志区域

* **命令编辑器**：
  - 可视化参数输入
  - 命令预览
  - 保存/加载命令配置

* **响应分析器**：
  - 实时解析收到的帧
  - 显示命令类型和参数
  - 错误检测和提示

### 6. 测试功能

* **SOC→MCU测试**：
  - 从SOC向MCU发送命令
  - 验证MCU响应
  - 测试各种车辆功能命令

* **MCU→SOC测试**：
  - 模拟MCU响应
  - 测试SOC对传入帧的处理

* **协议验证**：
  - CRC/校验和验证
  - 帧结构验证
  - 错误处理测试

* **批量测试**：
  - 支持批量命令执行
  - 测试序列创建
  - 自动化测试脚本

### 7. 文档

* 创建README.md文件，包含使用说明
* 记录协议实现细节
* 提供常见测试场景示例
* 命令参考手册

## 关键特性

* **完全独立**：不修改任何现有代码，作为外部工具使用
* **完整命令支持**：包含所有从代码中提取的命令
* **智能解析**：自动解析命令并生成适当的回复
* **用户友好界面**：适合技术和非技术用户
* **实时响应分析**：带错误检测和调试信息
* **可扩展架构**：用于添加新协议或命令
* **跨平台兼容性**：支持Windows、Linux、macOS

## 预期交付物

* 完整的Python项目，包含PyQt界面
* 安装和使用文档
* 测试脚本示例
* 命令参考手册
* 协议实现库
